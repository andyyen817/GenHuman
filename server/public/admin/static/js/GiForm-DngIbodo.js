import{at as e,au as a,av as l,aw as r,ax as t,ay as o,az as n,aA as u,aB as s,aC as i,aD as d,aE as f,aF as c,aG as p,aH as m,aI as y,d as v,c as h,M as g,f as b,Y as w,al as _,aj as x,g as k,o as C,a as V,w as B,j as F,m as P,i as j,h as A,F as $,l as E,V as I,G as q,t as O,r as z,E as S,b as T,_ as G}from"./index-DjSAiWeD.js";var L=Date.now;var M=e?function(a,l){return e(a,"toString",{configurable:!0,enumerable:!1,value:(r=l,function(){return r}),writable:!0});var r}:function(e){return e};var R,D,U,H=(R=M,D=0,U=0,function(){var e=L(),a=16-(e-U);if(U=e,a>0){if(++D>=800)return arguments[0]}else D=0;return R.apply(void 0,arguments)}),W=Math.max;var Y=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,J=/^\w*$/;var K="Expected a function";function N(e,a){if("function"!=typeof e||null!=a&&"function"!=typeof a)throw new TypeError(K);var l=function(){var r=arguments,t=a?a.apply(this,r):r[0],o=l.cache;if(o.has(t))return o.get(t);var n=e.apply(this,r);return l.cache=o.set(t,n)||o,n};return l.cache=new(N.Cache||r),l}N.Cache=r;var Q=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,X=/\\(\\)?/g,Z=function(e){var a=N(e,(function(e){return 500===l.size&&l.clear(),e})),l=a.cache;return a}((function(e){var a=[];return 46===e.charCodeAt(0)&&a.push(""),e.replace(Q,(function(e,l,r,t){a.push(r?t.replace(X,"$1"):l||e)})),a}));function ee(e,r){return a(e)?e:function(e,r){if(a(e))return!1;var t=typeof e;return!("number"!=t&&"symbol"!=t&&"boolean"!=t&&null!=e&&!l(e))||J.test(e)||!Y.test(e)||null!=r&&e in Object(r)}(e,r)?[e]:Z(t(e))}var ae=1/0;function le(e){if("string"==typeof e||l(e))return e;var a=e+"";return"0"==a&&1/e==-ae?"-0":a}var re=o?o.isConcatSpreadable:void 0;function te(e){return a(e)||n(e)||!!(re&&e&&e[re])}function oe(e,a,l,r,t){var o=-1,n=e.length;for(l||(l=te),t||(t=[]);++o<n;){var s=e[o];a>0&&l(s)?a>1?oe(s,a-1,l,r,t):u(t,s):r||(t[t.length]=s)}return t}function ne(e){return(null==e?0:e.length)?oe(e,1):[]}var ue="[object Object]",se=Function.prototype,ie=Object.prototype,de=se.toString,fe=ie.hasOwnProperty,ce=de.call(Object);function pe(e,a){return a.length<2?e:function(e,a){for(var l=0,r=(a=ee(a,e)).length;null!=e&&l<r;)e=e[le(a[l++])];return l&&l==r?e:void 0}(e,f(a,0,-1))}function me(e,a){return null==(e=pe(e,a=ee(a,e)))||delete e[le((l=a,r=null==l?0:l.length,r?l[r-1]:void 0))];var l,r}function ye(e){return function(e){if(!s(e)||i(e)!=ue)return!1;var a=d(e);if(null===a)return!0;var l=fe.call(a,"constructor")&&a.constructor;return"function"==typeof l&&l instanceof l&&de.call(l)==ce}(e)?void 0:e}var ve=function(e){return H(function(e,a,l){return a=W(void 0===a?e.length-1:a,0),function(){for(var r=arguments,t=-1,o=W(r.length-a,0),n=Array(o);++t<o;)n[t]=r[a+t];t=-1;for(var u=Array(a+1);++t<a;)u[t]=r[t];return u[a]=l(n),function(e,a,l){switch(l.length){case 0:return e.call(a);case 1:return e.call(a,l[0]);case 2:return e.call(a,l[0],l[1]);case 3:return e.call(a,l[0],l[1],l[2])}return e.apply(a,l)}(e,this,u)}}(e,void 0,ne),e+"")}((function(e,a){var l={};if(null==e)return l;var r=!1;a=c(a,(function(a){return a=ee(a,e),r||(r=a.length>1),a})),p(e,m(e),l),r&&(l=y(l,7,ye));for(var t=a.length;t--;)me(l,a[t]);return l}));const he=G(v({__name:"GiForm",props:{modelValue:{},layout:{},size:{},labelColProps:{},wrapperColProps:{},labelAlign:{},disabled:{},rules:{},autoLabelWidth:{default:!0},id:{},scrollToFirstError:{default:!0},columns:{},gridProps:{},gridItemProps:{default:()=>({span:{xs:24,sm:12}})},search:{type:Boolean,default:!1},defaultCollapsed:{type:Boolean,default:!1},searchBtnText:{default:"搜索"},hideFoldBtn:{type:Boolean,default:!1},suffix:{type:Boolean,default:!0}},emits:["update:modelValue","search","reset"],setup(e,{expose:a,emit:l}){const r=e,t=l,o=h((()=>{const e=ve(r,["columns","gridProps","gridItemProps","search","defaultCollapsed","searchBtnText","hideFoldBtn","suffix","layout"]);return{layout:r.search?"inline":"horizontal",...e}})),n=h((()=>r.gridItemProps)),u=g("formRef"),s=b(r.defaultCollapsed),i=w({}),d=new Map([["input",{allowClear:!0,maxLength:20}],["textarea",{allowClear:!1,maxLength:200}],["input-tag",{allowClear:!0}],["mention",{allowClear:!0}],["select",{allowClear:!0}],["tree-select",{allowClear:!0}],["cascader",{allowClear:!0}],["date-picker",{allowClear:!0}],["time-picker",{allowClear:!0}]]),f=e=>{if(e.type)return["input","input-tag","mention"].includes(e.type)?`请输入${e.label}`:["textarea"].includes(e.type)?`请填写${e.label}`:["select","tree-select","cascader"].includes(e.type)?`请选择${e.label}`:["date-picker"].includes(e.type)?"请选择日期":["time-picker"].includes(e.type)?"请选择时间":void 0},c=e=>{if(!e.type)return;return["select","tree-select","cascader","radio-group","checkbox-group"].includes(e.type)?i[e.field]||[]:void 0},p=e=>({...d.get(e.type)||{},placeholder:f(e),options:c(e),...e.props}),m=e=>e.required?[{required:!0,message:`${e.label}为必填项`},...Array.isArray(e.rules)?e.rules:[]]:e.rules,y=e=>"boolean"==typeof e.show?e.show:"function"==typeof e.show?e.show(r.modelValue):void 0,v=e=>void 0!==e.hide&&("boolean"==typeof e.hide?e.hide:"function"==typeof e.hide?e.hide(r.modelValue):void 0),G=e=>void 0!==e.disabled&&("boolean"==typeof e.disabled?e.disabled:"function"==typeof e.disabled?e.disabled(r.modelValue):void 0);r.columns.forEach((e=>{e.request&&"function"==typeof e.request&&(null==e?void 0:e.init)&&e.request(r.modelValue).then((a=>{i[e.field]=e.resultFormat?e.resultFormat(a):a.data}))}));const L=[];r.columns.forEach((e=>{var a;const l=L.map((e=>e.field));(null==(a=e.cascader)?void 0:a.length)&&!l.includes(e.field)&&L.push(e)}));const M=h((()=>_(r.modelValue)));return x(M,((e,a)=>{L.forEach((l=>{if(e[l.field]!==a[l.field]){r.columns.filter((e=>{var a;return null==(a=null==l?void 0:l.cascader)?void 0:a.includes(e.field)})).forEach((a=>{a.request&&Boolean(e[l.field])?a.request(r.modelValue).then((e=>{i[a.field]=a.resultFormat?a.resultFormat(e):e.data,i[a.field].map((e=>e.value)).includes(r.modelValue[a.field])||t("update:modelValue",Object.assign(r.modelValue,{[a.field]:Array.isArray(r.modelValue[a.field])?[]:""}))})):a.request&&!e[l.field]&&(i[a.field]=[],t("update:modelValue",Object.assign(r.modelValue,{[a.field]:Array.isArray(r.modelValue[a.field])?[]:""})))}))}}))})),a({formRef:u}),(e,a)=>{const l=k("a-alert"),i=k("a-form-item"),d=k("a-grid-item"),f=k("icon-search"),c=k("a-button"),h=k("icon-up"),g=k("icon-down"),b=k("a-space"),w=k("a-grid"),_=k("a-form");return C(),V(_,P({ref_key:"formRef",ref:u},j(o),{model:e.modelValue}),{default:B((()=>[F(w,P({class:"w-full","col-gap":8},r.gridProps,{collapsed:j(s)}),{default:B((()=>{var o;return[(C(!0),A($,null,E(e.columns,(a=>{var o,u;return C(),A($,{key:a.field},[(void 0!==a.show?y(a):!v(a))?(C(),V(d,P({key:0,ref_for:!0},a.gridItemProps||j(n),{span:a.span||(null==(o=a.gridItemProps)?void 0:o.span)||(null==(u=j(n))?void 0:u.span)}),{default:B((()=>[F(i,P({ref_for:!0},a.formItemProps,{field:a.field,rules:m(a),disabled:G(a)}),I({label:B((()=>["string"==typeof a.label?(C(),A($,{key:0},[q(O(a.label),1)],64)):(C(),V(z(a.label),{key:1}))])),default:B((()=>[["group-title"].includes(a.type||"")?S(e.$slots,"group-title",{key:1},(()=>[F(l,P({ref_for:!0},a.props),{default:B((()=>[q(O(a.label),1)])),_:2},1040)]),!0):S(e.$slots,a.field,P({key:0,ref_for:!0},{disabled:G(a)}),(()=>[(C(),V(z(`a-${a.type}`),P({ref_for:!0},p(a),{"model-value":e.modelValue[a.field],"onUpdate:modelValue":e=>{return l=e,o=a.field,void t("update:modelValue",Object.assign(r.modelValue,{[o]:l}));var l,o}}),I({_:2},[E(null==a?void 0:a.slots,((e,a)=>({name:a,fn:B((a=>["string"==typeof e?(C(),A($,{key:0},[q(O(e),1)],64)):e?(C(),V(z(e(a)),{key:1})):T("",!0)]))})))]),1040,["model-value","onUpdate:modelValue"]))]),!0)])),_:2},[E(null==a?void 0:a.formItemSlots,((e,a)=>({name:a,fn:B((()=>["string"==typeof e?(C(),A($,{key:0},[q(O(e),1)],64)):(C(),V(z(e),{key:1}))]))})))]),1040,["field","rules","disabled"])])),_:2},1040,["span"])):T("",!0)],64)})),128)),r.search?(C(),V(d,P({key:r.suffix?void 0:String(j(s))},j(n),{span:null==(o=j(n))?void 0:o.span,suffix:r.search&&(r.suffix||!r.suffix&&j(s))}),{default:B((()=>[F(b,{wrap:""},{default:B((()=>[S(e.$slots,"suffix",{},(()=>[F(c,{type:"primary",onClick:a[0]||(a[0]=e=>t("search"))},{icon:B((()=>[F(f)])),default:B((()=>[q(O(r.searchBtnText),1)])),_:1}),F(c,{onClick:a[1]||(a[1]=e=>t("reset"))},{default:B((()=>a[3]||(a[3]=[q("重置")]))),_:1}),r.hideFoldBtn?T("",!0):(C(),V(c,{key:0,class:"gi-form__fold-btn",type:"text",size:"mini",onClick:a[2]||(a[2]=e=>s.value=!j(s))},{icon:B((()=>[j(s)?(C(),V(g,{key:1})):(C(),V(h,{key:0}))])),default:B((()=>[q(O(j(s)?"展开":"收起"),1)])),_:1}))]),!0)])),_:3})])),_:3},16,["span","suffix"])):T("",!0)]})),_:3},16,["collapsed"])])),_:3},16,["model"])}}}),[["__scopeId","data-v-c2a116a2"]]);export{he as _};

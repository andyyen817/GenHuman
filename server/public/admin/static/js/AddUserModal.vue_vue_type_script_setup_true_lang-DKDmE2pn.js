import{_ as e}from"./index-CpCpF_S8.js";import{E as a,a as l}from"./regexp-CcC9eZsJ.js";import{f as s,d as t,c as d,M as o,g as i,o as u,a as r,w as m,j as n,i as c,fh as f,fi as p,b as v,H as _,fl as h,fm as w,$ as x}from"./index-BOEMWj3F.js";import{a as V}from"./role-DXaC-jZA.js";import{u as g}from"./useResetReactive-CxBS5QQ-.js";const b=t({__name:"AddUserModal",emits:["save-success"],setup(t,{expose:b,emit:k}){const y=k,{roleList:U,getRoleList:j}=function(){const e=s(!1),a=s([]),l=s(0);return{roleList:a,getRoleList:async()=>{try{e.value=!0;const s=await V({page:1,size:99});a.value=s.data.data.filter((e=>1===e.status)),l.value=s.data.total}finally{e.value=!1}},loading:e,total:l}}();j();const R=d((()=>U.value.map((e=>({label:e.title,value:e.id}))))),M={xs:24,sm:24,md:12,lg:12,xl:12,xxl:12},q=o("formRef"),L=s(""),z=d((()=>!!L.value)),H=d((()=>z.value?"编辑用户":"新增用户")),I=s(!1),[O,A]=g({id:"",avatar:"",password:"",username:"",nickname:"",role_id:"",description:"",status:1,type:2}),B={username:[{required:!0,message:"请输入用户名"},{min:2,max:4,message:"长度在 2 - 4个字符"}],nickname:[{required:!0,message:"请输入昵称"},{min:2,max:4,message:"长度在 2 - 4个字符"}],email:[{match:a,message:"邮箱格式不正确"}],phone:[{match:l,message:"手机号格式不正确"}],deptId:[{required:!0,message:"请选择所属部门"}],role_id:[{required:!0,message:"请选择角色"}],status:[{required:!0,message:"请选择状态"}]},C=()=>{var e;null==(e=q.value)||e.resetFields(),A()},E=async()=>{var e;try{if(await(null==(e=q.value)?void 0:e.validate()))return!1;return!!(await await w(O))&&(x.success("保存成功"),y("save-success"),!0)}catch(a){return!1}};return b({add:()=>{L.value="",I.value=!0},edit:async e=>{I.value=!0,L.value=e;const a=await h({id:e});Object.assign(O,a.data)}}),(a,l)=>{const s=e,t=i("a-form-item"),d=i("a-col"),o=i("a-input"),h=i("a-input-password"),w=i("a-select"),x=i("a-row"),V=i("a-textarea"),g=i("a-switch"),b=i("a-form"),k=i("a-modal");return u(),r(k,{visible:c(I),"onUpdate:visible":l[7]||(l[7]=e=>_(I)?I.value=e:null),title:c(H),width:"90%","mask-closable":!1,"modal-style":{maxWidth:"600px"},"body-style":{maxHeight:"70vh"},onBeforeOk:E,onClose:C},{default:m((()=>[n(b,{ref_key:"formRef",ref:q,model:c(O),rules:B,size:"medium","auto-label-width":""},{default:m((()=>[n(x,null,{default:m((()=>[n(d,f(p({xs:24,sm:24,md:24,lg:24,xl:24,xxl:24})),{default:m((()=>[c(I)?(u(),r(t,{key:0,label:"头像",field:"avatar"},{default:m((()=>[n(s,{modelValue:c(O).avatar,"onUpdate:modelValue":l[0]||(l[0]=e=>c(O).avatar=e)},null,8,["modelValue"])])),_:1})):v("",!0)])),_:1},16),n(d,f(p(M)),{default:m((()=>[n(t,{label:"用户名",field:"username"},{default:m((()=>[n(o,{modelValue:c(O).username,"onUpdate:modelValue":l[1]||(l[1]=e=>c(O).username=e),modelModifiers:{trim:!0},placeholder:"请输入用户名","allow-clear":""},null,8,["modelValue"])])),_:1})])),_:1},16),n(d,f(p(M)),{default:m((()=>[n(t,{label:"昵称",field:"nickname"},{default:m((()=>[n(o,{modelValue:c(O).nickname,"onUpdate:modelValue":l[2]||(l[2]=e=>c(O).nickname=e),modelModifiers:{trim:!0},placeholder:"请输入昵称","allow-clear":""},null,8,["modelValue"])])),_:1})])),_:1},16),n(d,f(p(M)),{default:m((()=>[n(t,{label:"密码",field:"password"},{default:m((()=>[n(h,{modelValue:c(O).password,"onUpdate:modelValue":l[3]||(l[3]=e=>c(O).password=e),modelModifiers:{trim:!0},placeholder:"请输入密码,为空不修改","allow-clear":""},null,8,["modelValue"])])),_:1})])),_:1},16),n(d,f(p(M)),{default:m((()=>[n(t,{label:"角色",field:"role_id"},{default:m((()=>[n(w,{modelValue:c(O).role_id,"onUpdate:modelValue":l[4]||(l[4]=e=>c(O).role_id=e),options:c(R),"value-key":"id",placeholder:"请选择所属角色","allow-clear":"","allow-search":{retainInputValue:!0}},null,8,["modelValue","options"])])),_:1})])),_:1},16)])),_:1}),n(t,{label:"描述",field:"description"},{default:m((()=>[n(V,{modelValue:c(O).description,"onUpdate:modelValue":l[5]||(l[5]=e=>c(O).description=e),modelModifiers:{trim:!0},"max-length":200,placeholder:"请填写描述","auto-size":{minRows:3},"show-word-limit":""},null,8,["modelValue"])])),_:1}),n(t,{label:"状态",field:"status"},{default:m((()=>[n(g,{modelValue:c(O).status,"onUpdate:modelValue":l[6]||(l[6]=e=>c(O).status=e),type:"round","checked-value":1,"unchecked-value":0,"checked-text":"正常","unchecked-text":"禁用"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])}}});export{b as _};

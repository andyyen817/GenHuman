import{d as e,M as a,f as s,c as l,g as t,o as i,a as n,w as r,j as c,i as u,H as d,Z as o,X as m,fj as v,$ as p}from"./index-CbZLgSae.js";import{e as f}from"./role-Cu9wJIMJ.js";import{b as h}from"./menu-Ql3OuPQn.js";const k=e({__name:"PermModal",setup(e,{expose:k}){const y=a("treeRef"),_=s([]);(async()=>{const e=await h(),a=m.mapTree(JSON.parse(JSON.stringify(e.data)),(e=>({id:e.id,title:e.title,children:e.children})));_.value=a,v((()=>{var e;null==(e=y.value)||e.expandAll()}))})();const b=l((()=>"分配权限")),j=s(!1),x=s([]),O=s(),g=()=>{const e=x.value?x.value.join(","):[];f({id:O.value,menu_ids:e}).then((()=>{p.success("保存成功"),j.value=!1})).catch((()=>{j.value=!0}))};return k({open:e=>{x.value=[],j.value=!0,O.value=e.id,e.menu_ids&&e.menu_ids.split(",").forEach((e=>{x.value.push(parseInt(e))}))}}),(e,a)=>{const s=t("a-tree"),l=t("a-modal");return i(),n(l,{visible:u(j),"onUpdate:visible":a[1]||(a[1]=e=>d(j)?j.value=e:null),title:u(b),fullscreen:u(o)(),"mask-closable":!0,onOk:g},{default:r((()=>[c(s,{ref_key:"treeRef",ref:y,"checked-keys":u(x),"onUpdate:checkedKeys":a[0]||(a[0]=e=>d(x)?x.value=e:null),size:"mini",checkable:"","check-strictly":!0,data:u(_),"field-names":{key:"id"}},null,8,["checked-keys","data"])])),_:1},8,["visible","title","fullscreen"])}}});export{k as _};

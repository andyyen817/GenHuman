<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vidspark Token æ¸¬è©¦å·¥å…·</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 20px auto; 
            padding: 20px; 
            background-color: #f5f5f5; 
        }
        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .form-group { 
            margin: 20px 0; 
        }
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: bold; 
        }
        input[type="text"] { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
            font-size: 14px; 
        }
        .btn { 
            background: #3498DB; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 16px; 
            margin: 5px; 
        }
        .btn:hover { background: #2980B9; }
        .btn:disabled { background: #bdc3c7; cursor: not-allowed; }
        .btn-success { background: #27AE60; }
        .btn-danger { background: #E74C3C; }
        .btn-warning { background: #F39C12; }
        .result { 
            margin-top: 20px; 
            padding: 15px; 
            border-radius: 5px; 
            display: none; 
        }
        .success { background: #D4EDDA; color: #155724; border: 1px solid #C3E6CB; }
        .error { background: #F8D7DA; color: #721C24; border: 1px solid #F5C6CB; }
        .info { background: #D1ECF1; color: #0C5460; border: 1px solid #BEE5EB; }
        .loading { background: #FFF3CD; color: #856404; border: 1px solid #FFEAA7; }
        pre { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            overflow-x: auto; 
            white-space: pre-wrap; 
            max-height: 300px;
            overflow-y: auto;
        }
        .token-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .status-card {
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498DB;
            background: #f8f9fa;
        }
        .instructions {
            background: #E8F5E8;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #27AE60;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”‘ Vidspark Token æ¸¬è©¦å·¥å…·</h1>
        <p><strong>ç›®çš„</strong>ï¼šæ¸¬è©¦GenHuman API Tokençš„æœ‰æ•ˆæ€§</p>
        <p><strong>ç‰ˆæœ¬</strong>ï¼šv1.0 | <strong>æ—¥æœŸ</strong>ï¼š2025-08-29</p>
        
        <div class="instructions">
            <h3>ğŸ“‹ ä½¿ç”¨èªªæ˜</h3>
            <ol>
                <li>åœ¨ä¸‹æ–¹è¼¸å…¥æ‚¨çš„GenHuman API Token</li>
                <li>é»æ“Š"é©—è­‰Token"æŒ‰éˆ•é€²è¡Œæ¸¬è©¦</li>
                <li>ç³»çµ±æœƒå‘Šè¨´æ‚¨Tokenæ˜¯å¦æœ‰æ•ˆåŠå…·é«”å•é¡Œ</li>
                <li>å¦‚æœTokenæœ‰æ•ˆï¼Œå¯ä»¥ç¹¼çºŒæ¸¬è©¦APIåŠŸèƒ½</li>
            </ol>
            <p><strong>ğŸ“Œ Tokenæ ¼å¼</strong>ï¼šæ‡‰è©²æ˜¯é¡ä¼¼ "08D7EE7F91D258F27B44DDF59CDDDEDE.1E95F76130BA23D3" çš„æ ¼å¼</p>
        </div>

        <div class="form-group">
            <label for="api-token">ğŸ”‘ GenHuman API Token:</label>
            <input type="text" id="api-token" placeholder="è«‹è¼¸å…¥æ‚¨çš„GenHuman API Token" 
                   value="08D7EE7F91D258F27B44DDF59CDDDEDE.1E95F76130BA23D3">
        </div>

        <div class="form-group">
            <button class="btn" onclick="validateToken()" id="validate-btn">ğŸ” é©—è­‰Token</button>
            <button class="btn btn-success" onclick="testFreeAvatar()" id="test-avatar-btn" disabled>ğŸ­ æ¸¬è©¦å…è²»æ•¸å­—äºº</button>
            <button class="btn btn-warning" onclick="clearResults()">ğŸ§¹ æ¸…é™¤çµæœ</button>
        </div>

        <div id="result" class="result"></div>

        <div class="token-status">
            <div class="status-card">
                <h4>ğŸŒ APIç«¯é»</h4>
                <p><strong>åŸºç¤åœ°å€</strong>: https://api.yidevs.com</p>
                <p><strong>æ¸¬è©¦ç«¯é»</strong>: /app/human/human/Index/created</p>
            </div>
            
            <div class="status-card">
                <h4>ğŸ“Š ç•¶å‰ç‹€æ…‹</h4>
                <p id="token-status">æœªæ¸¬è©¦</p>
                <p id="last-test-time">-</p>
            </div>
        </div>

        <hr>
        <p style="text-align: center; color: #666; margin-top: 30px;">
            <strong>Vidspark Tokenæ¸¬è©¦å·¥å…· v1.0</strong><br>
            <a href="https://genhuman-digital-human.zeabur.app/" target="_blank">è¿”å›ä¸»ç«™</a> | 
            <a href="/vidspark-database-init.php" target="_blank">æ•¸æ“šåº«ç®¡ç†</a> |
            <a href="/vidspark/" target="_blank">Vidsparkå‰ç«¯</a>
        </p>
    </div>

    <script>
        // å…¨å±€è®Šé‡
        let currentToken = '';
        let tokenValid = false;

        function showResult(content, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result ' + type;
            resultDiv.innerHTML = content;
        }

        function showLoading(message) {
            showResult('<p>â³ ' + message + '</p>', 'loading');
        }

        function updateTokenStatus(status, time = null) {
            document.getElementById('token-status').textContent = status;
            document.getElementById('last-test-time').textContent = time || new Date().toLocaleString();
        }

        function updateButtons(valid) {
            tokenValid = valid;
            document.getElementById('test-avatar-btn').disabled = !valid;
        }

        function clearResults() {
            document.getElementById('result').style.display = 'none';
            updateTokenStatus('æœªæ¸¬è©¦', '-');
            updateButtons(false);
        }

        async function validateToken() {
            const token = document.getElementById('api-token').value.trim();
            
            if (!token) {
                showResult('<h4>âŒ Tokené©—è­‰å¤±æ•—</h4><p>è«‹å…ˆè¼¸å…¥Token</p>', 'error');
                return;
            }

            // Tokenæ ¼å¼é©—è­‰
            if (token.length < 20) {
                showResult('<h4>âŒ Tokenæ ¼å¼éŒ¯èª¤</h4><p>Tokené•·åº¦ä¸è¶³ï¼Œæ‡‰è©²è‡³å°‘20å€‹å­—ç¬¦</p>', 'error');
                updateTokenStatus('æ ¼å¼éŒ¯èª¤');
                updateButtons(false);
                return;
            }

            if (!/^[A-Z0-9.]+$/i.test(token)) {
                showResult('<h4>âŒ Tokenæ ¼å¼éŒ¯èª¤</h4><p>Tokenåªèƒ½åŒ…å«å­—æ¯ã€æ•¸å­—å’Œé»è™Ÿ</p>', 'error');
                updateTokenStatus('æ ¼å¼éŒ¯èª¤');
                updateButtons(false);
                return;
            }

            currentToken = token;
            showLoading('æ­£åœ¨é©—è­‰Tokenæœ‰æ•ˆæ€§...');
            updateTokenStatus('é©—è­‰ä¸­...');
            
            try {
                const response = await fetch('https://api.yidevs.com/app/human/human/Index/created', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + token,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        text: 'æ¸¬è©¦Tokenæœ‰æ•ˆæ€§'
                    })
                });

                const data = await response.json();
                
                console.log('APIéŸ¿æ‡‰:', data);

                if (response.ok && data.code === 200) {
                    // Tokenæœ‰æ•ˆä¸”APIèª¿ç”¨æˆåŠŸ
                    showResult(
                        '<h4>âœ… Tokené©—è­‰æˆåŠŸï¼</h4>' +
                        '<p><strong>ç‹€æ…‹</strong>: Tokenæœ‰æ•ˆï¼ŒAPIèª¿ç”¨æˆåŠŸ</p>' +
                        '<p><strong>éŸ¿æ‡‰ç¢¼</strong>: ' + data.code + '</p>' +
                        '<p><strong>æ¶ˆæ¯</strong>: ' + (data.msg || 'æˆåŠŸ') + '</p>' +
                        '<p><strong>Tokenæ©ç¢¼</strong>: ' + maskToken(token) + '</p>' +
                        '<details><summary>æŸ¥çœ‹å®Œæ•´éŸ¿æ‡‰</summary><pre>' + JSON.stringify(data, null, 2) + '</pre></details>',
                        'success'
                    );
                    updateTokenStatus('âœ… æœ‰æ•ˆ');
                    updateButtons(true);
                    
                } else if (response.ok && data.code === 401) {
                    // Tokenç„¡æ•ˆ
                    showResult(
                        '<h4>âŒ Tokenç„¡æ•ˆ</h4>' +
                        '<p><strong>éŒ¯èª¤ç¢¼</strong>: ' + data.code + '</p>' +
                        '<p><strong>éŒ¯èª¤ä¿¡æ¯</strong>: ' + (data.msg || 'Tokenä¸å­˜åœ¨æˆ–å·²éæœŸ') + '</p>' +
                        '<p><strong>å»ºè­°</strong>: è«‹æª¢æŸ¥Tokenæ˜¯å¦æ­£ç¢ºï¼Œæˆ–å¾GenHumanæ§åˆ¶å°é‡æ–°ç²å–</p>' +
                        '<details><summary>æŸ¥çœ‹å®Œæ•´éŸ¿æ‡‰</summary><pre>' + JSON.stringify(data, null, 2) + '</pre></details>',
                        'error'
                    );
                    updateTokenStatus('âŒ ç„¡æ•ˆ');
                    updateButtons(false);
                    
                } else {
                    // å…¶ä»–APIéŒ¯èª¤
                    showResult(
                        '<h4>âš ï¸ APIèª¿ç”¨ç•°å¸¸</h4>' +
                        '<p><strong>HTTPç‹€æ…‹</strong>: ' + response.status + '</p>' +
                        '<p><strong>éŸ¿æ‡‰ç¢¼</strong>: ' + (data.code || 'unknown') + '</p>' +
                        '<p><strong>éŒ¯èª¤ä¿¡æ¯</strong>: ' + (data.msg || data.message || 'æœªçŸ¥éŒ¯èª¤') + '</p>' +
                        '<details><summary>æŸ¥çœ‹å®Œæ•´éŸ¿æ‡‰</summary><pre>' + JSON.stringify(data, null, 2) + '</pre></details>',
                        'error'
                    );
                    updateTokenStatus('âš ï¸ ç•°å¸¸');
                    updateButtons(false);
                }

            } catch (error) {
                showResult(
                    '<h4>âŒ ç¶²çµ¡éŒ¯èª¤</h4>' +
                    '<p><strong>éŒ¯èª¤é¡å‹</strong>: ç¶²çµ¡é€£æ¥å¤±æ•—</p>' +
                    '<p><strong>éŒ¯èª¤ä¿¡æ¯</strong>: ' + error.message + '</p>' +
                    '<p><strong>å¯èƒ½åŸå› </strong>:</p>' +
                    '<ul>' +
                    '<li>ç¶²çµ¡é€£æ¥å•é¡Œ</li>' +
                    '<li>GenHuman APIæœå‹™ä¸å¯ç”¨</li>' +
                    '<li>CORSè·¨åŸŸé™åˆ¶</li>' +
                    '</ul>',
                    'error'
                );
                updateTokenStatus('âŒ ç¶²çµ¡éŒ¯èª¤');
                updateButtons(false);
            }
        }

        async function testFreeAvatar() {
            if (!tokenValid || !currentToken) {
                showResult('<h4>âŒ ç„¡æ³•æ¸¬è©¦</h4><p>è«‹å…ˆé©—è­‰Tokenæœ‰æ•ˆæ€§</p>', 'error');
                return;
            }

            showLoading('æ­£åœ¨æ¸¬è©¦å…è²»æ•¸å­—äººAPI...');
            
            try {
                const response = await fetch('https://api.yidevs.com/app/human/human/Index/created', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + currentToken,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        text: 'é€™æ˜¯Vidsparkçš„æ¸¬è©¦ï¼Œæ¸¬è©¦å…è²»æ•¸å­—äººç”ŸæˆåŠŸèƒ½ã€‚',
                        avatar_id: 1,
                        voice_id: 1
                    })
                });

                const data = await response.json();

                if (response.ok && data.code === 200) {
                    showResult(
                        '<h4>ğŸ‰ å…è²»æ•¸å­—äººAPIæ¸¬è©¦æˆåŠŸï¼</h4>' +
                        '<p><strong>ä»»å‹™ç‹€æ…‹</strong>: å·²æäº¤</p>' +
                        '<p><strong>ä»»å‹™ID</strong>: ' + (data.data?.task_id || 'æœªè¿”å›') + '</p>' +
                        '<p><strong>é è¨ˆæ™‚é–“</strong>: 2-5åˆ†é˜</p>' +
                        '<p><strong>éŸ¿æ‡‰ä¿¡æ¯</strong>: ' + (data.msg || 'æˆåŠŸ') + '</p>' +
                        '<details><summary>æŸ¥çœ‹å®Œæ•´éŸ¿æ‡‰</summary><pre>' + JSON.stringify(data, null, 2) + '</pre></details>',
                        'success'
                    );
                } else {
                    showResult(
                        '<h4>âŒ å…è²»æ•¸å­—äººAPIæ¸¬è©¦å¤±æ•—</h4>' +
                        '<p><strong>éŒ¯èª¤ç¢¼</strong>: ' + (data.code || response.status) + '</p>' +
                        '<p><strong>éŒ¯èª¤ä¿¡æ¯</strong>: ' + (data.msg || data.message || 'æœªçŸ¥éŒ¯èª¤') + '</p>' +
                        '<details><summary>æŸ¥çœ‹å®Œæ•´éŸ¿æ‡‰</summary><pre>' + JSON.stringify(data, null, 2) + '</pre></details>',
                        'error'
                    );
                }

            } catch (error) {
                showResult(
                    '<h4>âŒ ç¶²çµ¡éŒ¯èª¤</h4>' +
                    '<p><strong>éŒ¯èª¤ä¿¡æ¯</strong>: ' + error.message + '</p>',
                    'error'
                );
            }
        }

        function maskToken(token) {
            if (!token || token.length < 10) return 'invalid';
            return token.substring(0, 8) + '...' + token.substring(token.length - 4);
        }

        // é é¢åŠ è¼‰æ™‚è‡ªå‹•æª¢æŸ¥localStorageä¸­çš„token
        window.addEventListener('DOMContentLoaded', function() {
            const savedToken = localStorage.getItem('vidspark_api_token');
            if (savedToken) {
                document.getElementById('api-token').value = savedToken;
                console.log('å·²å¾localStorageåŠ è¼‰Token');
            }
        });

        // ä¿å­˜Tokenåˆ°localStorage
        document.getElementById('api-token').addEventListener('change', function() {
            const token = this.value.trim();
            if (token) {
                localStorage.setItem('vidspark_api_token', token);
            }
        });
    </script>
</body>
</html>

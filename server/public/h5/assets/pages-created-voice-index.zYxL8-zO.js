import{h as e,o as a,c as l,w as t,d as s,G as n,g as o,Q as c,j as u,y as i,R as r,p as f,q as d,M as v,e as p,t as m,u as h,J as x,T as _,U as b,f as g,C as w,l as y,m as k,r as C,k as P,V as T,n as j,a as D,b as M,F as S,v as E,A as N,$ as R,W as U,P as F}from"./index-CO0MWxLR.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as O}from"./y-footer.DZL6ZxFj.js";import{_ as V}from"./y-popup.BRJscbv0.js";import{c as J}from"./voice.BlNYc7E6.js";const z=I({__name:"y-voice-ani",setup(c){const u=e(!0);return(e,c)=>{const i=o;return a(),l(i,null,{default:t((()=>[s(i,{class:"identify-btn-media"},{default:t((()=>[s(i,{class:n(["identify-btn-box",{active:u.value}])},{default:t((()=>[s(i,{class:"loading"},{default:t((()=>[s(i,{class:"line1"}),s(i,{class:"line3"}),s(i,{class:"line2"}),s(i,{class:"line4"}),s(i,{class:"line5"}),s(i,{class:"line3"}),s(i,{class:"line4"}),s(i,{class:"line1"}),s(i,{class:"line2"})])),_:1})])),_:1},8,["class"])])),_:1})])),_:1})}}},[["__scopeId","data-v-b458333f"]]),A=I({__name:"y-record",props:{maxDuration:{type:Number,default:30}},emits:["success"],setup(y,{emit:k}){const C=k,P=y,T=e(1),j=e(0);let D,M=!1;const S=e(!0),E=e(!1);let N,R,U,F=[],I=c();const O=e(!1);u((()=>{G(),A()}));const V=()=>{j.value=0,M?navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{T.value=2,F=[],N=e,D=new MediaRecorder(e,{audioBitsPerSecond:128e3}),D.ondataavailable=e=>{E.value=!0,F.push(e.data)},D.onstop=()=>{clearInterval(U),E.value=!1;const e=new File(F,"recorder.mp3",{type:"audio/mp3"}),a=URL.createObjectURL(e);I.src=a,C("success",{url:a,duration:j.value})},D.start(),R=(new Date).getTime(),U=setInterval((()=>{j.value=Math.floor(((new Date).getTime()-R)/1e3),P.maxDuration&&j.value>=P.maxDuration&&J()}),1e3),E.value=!0})).catch((e=>{let a="";switch(e.name){case"NotAllowedError":a="当前浏览器不支持录音，请更换浏览器或在微信中打开。";break;case"NotReadableError":a="麦克风权限被拒绝，请刷新页面后授权麦克风权限。";break;default:a="未知错误，请刷新页面重试："+JSON.stringify(e)}i({content:a,success:e=>{e.confirm&&_()}})})):x.toast("请允许使用麦克风")},J=()=>{T.value=3,D.stop(),N.getTracks().forEach((e=>{e.stop()}))},A=()=>{I.onCanplay((()=>{I.duration!=1/0&&(j.value=Math.ceil(I.duration))})),I.onPlay((()=>{O.value=!0})),I.onStop((()=>{O.value=!1})),I.onPause((()=>{O.value=!1}))},B=()=>{0==O.value?I.play():I.pause()},G=()=>"https:"!==location.protocol?(i({content:"录音只能在HTTPS环境中使用"}),S.value=!1):navigator.mediaDevices&&window.MediaRecorder?(document.createElement("audio"),void navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{M=!0,e.getTracks().forEach((e=>{e.stop()}))})).catch((e=>{i({content:JSON.stringify(e)})}))):(i({content:"当前浏览器不支持录音，请更换浏览器或在微信中打开。"}),S.value=!1),L=()=>{b({count:1,extension:["mp3","wav","m4a","webm"],success:e=>{I.src=e.tempFilePaths[0],C("success",{url:e.tempFilePaths[0],duration:j.value}),T.value=3}})};return r((()=>{if(I)try{I.pause(),I.destroy()}catch(e){}})),(e,c)=>{const u=g,i=o,r=f(d("y-voice-ani"),z),_=w;return a(),l(i,{class:"w-p-100 flex flex-center flex-column"},{default:t((()=>[1==T.value?(a(),l(i,{key:0,class:"w-80 h-80 flex flex-center bg-blue round-circle",onClick:V},{default:t((()=>[s(u,{class:"iconfont icon-luyin1 text-white fs-40"})])),_:1})):v("",!0),2==T.value?(a(),l(i,{key:1,class:"flex flex-column flex-center gap-20"},{default:t((()=>[s(u,{class:"fs-26 fw-600"},{default:t((()=>[p(m(h(x).formatSecondsToMinutes(j.value)),1)])),_:1}),s(i,{class:"h-30"},{default:t((()=>[s(r)])),_:1}),s(_,{class:"fs-14 bg-blue text-white",onClick:J},{default:t((()=>[p("完成录制")])),_:1})])),_:1})):v("",!0),3==T.value?(a(),l(i,{key:2,class:"flex flex-y-center gap-20"},{default:t((()=>[s(i,{class:"w-60 h-60 flex flex-center bg-21 round-circle",onClick:c[0]||(c[0]=e=>T.value=1)},{default:t((()=>[s(u,{class:"iconfont icon-fanhui fs-25"})])),_:1}),s(i,{class:"w-80 h-80 flex flex-center bg-blue round-circle",onClick:B},{default:t((()=>[s(u,{class:n(["iconfont text-white fs-40",O.value?"icon-zanting1":"icon-bofang"])},null,8,["class"])])),_:1}),s(i,{class:"w-60 h-60 flex flex-center bg-green round-circle",onClick:V},{default:t((()=>[s(u,{class:"iconfont icon-zhongshi1 text-white fs-25"})])),_:1})])),_:1})):v("",!0),s(i,{class:"border-blue p-8 mt-20 round-10 flex flex-y-center pr-16",style:{"border-style":"dashed","border-width":"0.5px"}},{default:t((()=>[s(i,{class:"w-60 h-60 round-8 flex flex-center"},{default:t((()=>[s(u,{class:"iconfont icon-shangchuanwenjian fs-25"})])),_:1}),s(i,{class:"flex flex-column gap-8 ml-8",onClick:L},{default:t((()=>[s(u,{class:"fs-16"},{default:t((()=>[p("从文件中选择")])),_:1}),s(u,{class:"fs-12 text-grey-1"},{default:t((()=>[p("格式要求:mp3 m4a wav")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-a9739059"]]),B={__name:"index",setup(n){const{WEBCONFIG:c}=y(k()),u=C([{value:1,label:"普通语音"},{value:2,label:"深度语音"}]);y(P());const i=e(),r=e({title:"",url:"",duration:0,voiceChannel:1}),v=e(0);T((()=>r.value.voiceChannel),(e=>{v.value=1===e?c.value.voicePoint:2===e?c.value.voiceDeepPoint:0}),{immediate:!0});const h=e("");j((()=>{var e,a;9999!=(null==(e=null==c?void 0:c.value)?void 0:e.voiceChannel)&&(r.value.voiceChannel=(null==(a=null==c?void 0:c.value)?void 0:a.voiceChannel)||1)}));const _=e=>{h.value=e.url,r.value.duration=e.duration},b=()=>{""!=r.value.title&&""!=h.value?(E({title:"创建中...",mask:!0}),r.value.url?J(r.value).then((e=>{N(),x.toast("创建成功"),setTimeout((()=>{R.back()}),500)})):U({filePath:h.value}).then((e=>{r.value.url=e.data.file_url,J(r.value).then((e=>{N(),x.toast("创建成功"),setTimeout((()=>{R.back()}),500)}))})).catch((e=>{console.log(e),N(),x.toast(e.msg)}))):x.toast("请填写完整数据","error")},w=()=>{9999==c.value.voiceChannel&&i.value.open()};return(e,n)=>{const c=g,h=F,x=o,y=f(d("y-record"),A),k=f(d("y-footer"),O),C=f(d("y-popup"),V);return a(),l(x,{class:"p-8 fs-15"},{default:t((()=>[s(x,{class:"bg-white p-15 round-8 mt-20"},{default:t((()=>[s(c,{class:"fw-600"},{default:t((()=>[p("音色名称")])),_:1}),s(x,{class:"bg-fa round-6 mt-6 p-12"},{default:t((()=>[s(h,{placeholder:"请输入音色名称...",class:"fs-14",modelValue:r.value.title,"onUpdate:modelValue":n[0]||(n[0]=e=>r.value.title=e)},null,8,["modelValue"])])),_:1})])),_:1}),s(x,{class:"bg-white p-15 round-8 mt-20 flex flex-x-space-between",onClick:w},{default:t((()=>[s(c,{class:"fw-600"},{default:t((()=>[p("克隆模式")])),_:1}),s(x,{class:"flex flex-y-center gap-4"},{default:t((()=>{var e;return[p(m(null==(e=u.find((e=>e.value===r.value.voiceChannel)))?void 0:e.label)+" ",1),s(c,{class:"iconfont icon-youjiantou"})]})),_:1})])),_:1}),s(x,{class:"w-p-100 flex flex-column gap-6 mt-20 bg-white p-15"},{default:t((()=>[s(c,{class:"fw-600"},{default:t((()=>[p("上传音频")])),_:1}),s(x,{class:"flex flex-center"},{default:t((()=>[s(y,{onSuccess:_})])),_:1})])),_:1}),s(k,{onSuccess:b},{default:t((()=>[p(m(v.value)+" 算力克隆声音",1)])),_:1}),s(C,{ref_key:"popup",ref:i,mode:"bottom",round:"8px"},{default:t((()=>[(a(!0),D(S,null,M(u,((e,s)=>(a(),l(x,{class:"w-p-100 wa py-8 text-center border-bottom-f1",onClick:a=>{r.value.voiceChannel=e.value,i.value.close()}},{default:t((()=>[p(m(e.label),1)])),_:2},1032,["onClick"])))),256)),s(x,{class:"bg-white round-8 py-8 text-center text-red wa",onClick:n[1]||(n[1]=e=>i.value.close())},{default:t((()=>[p("取消")])),_:1})])),_:1},512)])),_:1})}}};export{B as default};

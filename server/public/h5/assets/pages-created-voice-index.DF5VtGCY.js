import{j as e,a,c as l,w as t,e as s,I as n,h as o,Q as c,o as u,y as i,R as r,p as f,q as d,M as v,f as p,t as m,u as h,J as x,T as _,U as b,g,C as w,l as y,m as k,V as C,r as M,k as T,W as j,n as D,b as P,d as S,F as E,v as F,A as I,$ as N,X as R,P as U}from"./index-B-vd46OS.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as V}from"./y-footer.DYKP-ux_.js";import{_ as A}from"./y-popup.BxIp_g78.js";import{c as B}from"./voice.CQPWuZUf.js";const J=O({__name:"y-voice-ani",setup(c){const u=e(!0);return(e,c)=>{const i=o;return a(),l(i,null,{default:t((()=>[s(i,{class:"identify-btn-media"},{default:t((()=>[s(i,{class:n(["identify-btn-box",{active:u.value}])},{default:t((()=>[s(i,{class:"loading"},{default:t((()=>[s(i,{class:"line1"}),s(i,{class:"line3"}),s(i,{class:"line2"}),s(i,{class:"line4"}),s(i,{class:"line5"}),s(i,{class:"line3"}),s(i,{class:"line4"}),s(i,{class:"line1"}),s(i,{class:"line2"})])),_:1})])),_:1},8,["class"])])),_:1})])),_:1})}}},[["__scopeId","data-v-b458333f"]]),q=O({__name:"y-record",props:{maxDuration:{type:Number,default:30}},emits:["success"],setup(y,{emit:k}){const C=k,M=y,T=e(1),j=e(0);let D,P=!1;const S=e(!0),E=e(!1);let F,I,N,R=[],U=c();const O=e(!1);u((()=>{z(),B()}));const V=()=>{j.value=0,P?navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{T.value=2,R=[],F=e,D=new MediaRecorder(e,{audioBitsPerSecond:128e3}),D.ondataavailable=e=>{E.value=!0,R.push(e.data)},D.onstop=()=>{clearInterval(N),E.value=!1;const e=new File(R,W(10)+"recorder.mp3",{type:"audio/mp3"}),a=URL.createObjectURL(e);U.src=a,C("success",{url:a,duration:j.value,file:e})},D.start(),I=(new Date).getTime(),N=setInterval((()=>{j.value=Math.floor(((new Date).getTime()-I)/1e3),M.maxDuration&&j.value>=M.maxDuration&&A()}),1e3),E.value=!0})).catch((e=>{let a="";switch(e.name){case"NotAllowedError":a="当前浏览器不支持录音，请更换浏览器或在微信中打开。";break;case"NotReadableError":a="麦克风权限被拒绝，请刷新页面后授权麦克风权限。";break;default:a="未知错误，请刷新页面重试："+JSON.stringify(e)}i({content:a,success:e=>{e.confirm&&_()}})})):x.toast("请允许使用麦克风")},A=()=>{T.value=3,D.stop(),F.getTracks().forEach((e=>{e.stop()}))},B=()=>{U.onCanplay((()=>{U.duration!=1/0&&(j.value=Math.ceil(U.duration))})),U.onPlay((()=>{O.value=!0})),U.onStop((()=>{O.value=!1})),U.onPause((()=>{O.value=!1}))},q=()=>{0==O.value?U.play():U.pause()},z=()=>"https:"!==location.protocol?(i({content:"录音只能在HTTPS环境中使用"}),S.value=!1):navigator.mediaDevices&&window.MediaRecorder?(document.createElement("audio"),void navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{P=!0,e.getTracks().forEach((e=>{e.stop()}))})).catch((e=>{i({content:JSON.stringify(e)})}))):(i({content:"当前浏览器不支持录音，请更换浏览器或在微信中打开。"}),S.value=!1),L=()=>{b({count:1,extension:["mp3","wav","m4a","webm"],success:e=>{U.src=e.tempFilePaths[0],C("success",{url:e.tempFilePaths[0],file:e.tempFiles[0],duration:j.value}),T.value=3}})};r((()=>{if(U)try{U.pause(),U.destroy()}catch(e){}}));const W=e=>{for(var a="",l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=l.length,s=0;s<e;s++)a+=l.charAt(Math.floor(Math.random()*t));return a};return(e,c)=>{const u=g,i=o,r=f(d("y-voice-ani"),J),_=w;return a(),l(i,{class:"w-p-100 flex flex-center flex-column"},{default:t((()=>[1==T.value?(a(),l(i,{key:0,class:"w-80 h-80 flex flex-center bg-blue round-circle",onClick:V},{default:t((()=>[s(u,{class:"iconfont icon-luyin1 text-white fs-40"})])),_:1})):v("",!0),2==T.value?(a(),l(i,{key:1,class:"flex flex-column flex-center gap-20"},{default:t((()=>[s(u,{class:"fs-26 fw-600"},{default:t((()=>[p(m(h(x).formatSecondsToMinutes(j.value)),1)])),_:1}),s(i,{class:"h-30"},{default:t((()=>[s(r)])),_:1}),s(_,{class:"fs-14 bg-blue text-white",onClick:A},{default:t((()=>[p("完成录制")])),_:1})])),_:1})):v("",!0),3==T.value?(a(),l(i,{key:2,class:"flex flex-y-center gap-20"},{default:t((()=>[s(i,{class:"w-60 h-60 flex flex-center bg-21 round-circle",onClick:c[0]||(c[0]=e=>T.value=1)},{default:t((()=>[s(u,{class:"iconfont icon-fanhui fs-25"})])),_:1}),s(i,{class:"w-80 h-80 flex flex-center bg-blue round-circle",onClick:q},{default:t((()=>[s(u,{class:n(["iconfont text-white fs-40",O.value?"icon-zanting1":"icon-bofang"])},null,8,["class"])])),_:1}),s(i,{class:"w-60 h-60 flex flex-center bg-green round-circle",onClick:V},{default:t((()=>[s(u,{class:"iconfont icon-zhongshi1 text-white fs-25"})])),_:1})])),_:1})):v("",!0),s(i,{class:"border-blue p-8 mt-20 round-10 flex flex-y-center pr-16",style:{"border-style":"dashed","border-width":"0.5px"}},{default:t((()=>[s(i,{class:"w-60 h-60 round-8 flex flex-center"},{default:t((()=>[s(u,{class:"iconfont icon-shangchuanwenjian fs-25"})])),_:1}),s(i,{class:"flex flex-column gap-8 ml-8",onClick:L},{default:t((()=>[s(u,{class:"fs-16"},{default:t((()=>[p("从文件中选择")])),_:1}),s(u,{class:"fs-12 text-grey-1"},{default:t((()=>[p("格式要求:mp3 m4a wav")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-bb0517c9"]]),z={__name:"index",setup(n){const{WEBCONFIG:c}=y(k()),u=C((()=>0==b.value?"免费创建":"克隆音色 消耗算力:"+b.value)),r=e({url:"",file:null,duration:0}),v=M([{value:1,label:"普通语音"},{value:2,label:"深度语音"}]);y(T());const h=e(),_=e({title:"",url:"",duration:0,voiceChannel:1}),b=e(0);j((()=>_.value.voiceChannel),(e=>{b.value=1===e?c.value.voicePoint:2===e?c.value.voiceDeepPoint:0}),{immediate:!0}),D((()=>{var e,a;9999!=(null==(e=null==c?void 0:c.value)?void 0:e.voiceChannel)&&(_.value.voiceChannel=(null==(a=null==c?void 0:c.value)?void 0:a.voiceChannel)||1)}));const w=e=>{r.value=e,_.value.duration=e.duration},O=()=>{if(""==_.value.title||""==r.value.url&&null==r.value.file)x.toast("请填写完整数据","error");else if(F({title:"创建中...",mask:!0}),_.value.url)B(_.value).then((e=>{I(),x.toast("创建成功"),setTimeout((()=>{N.back()}),500)}));else try{R({file:r.value.file}).then((e=>{_.value.url=e.data.file_url,B(_.value).then((e=>{I(),x.toast("创建成功"),setTimeout((()=>{N.back()}),500)}))})).catch((e=>{I(),x.toast(e.msg)}))}catch(e){i({title:"错误",content:e})}},J=()=>{9999==c.value.voiceChannel&&h.value.open()};return(e,n)=>{const c=g,i=U,r=o,x=f(d("y-record"),q),b=f(d("y-footer"),V),y=f(d("y-popup"),A);return a(),l(r,{class:"p-8 fs-15"},{default:t((()=>[s(r,{class:"bg-white p-15 round-8 mt-20"},{default:t((()=>[s(c,{class:"fw-600"},{default:t((()=>[p("音色名称")])),_:1}),s(r,{class:"bg-fa round-6 mt-6 p-12"},{default:t((()=>[s(i,{placeholder:"请输入音色名称...",class:"fs-14",modelValue:_.value.title,"onUpdate:modelValue":n[0]||(n[0]=e=>_.value.title=e)},null,8,["modelValue"])])),_:1})])),_:1}),s(r,{class:"bg-white p-15 round-8 mt-20 flex flex-x-space-between",onClick:J},{default:t((()=>[s(c,{class:"fw-600"},{default:t((()=>[p("克隆模式")])),_:1}),s(r,{class:"flex flex-y-center gap-4"},{default:t((()=>{var e;return[p(m(null==(e=v.find((e=>e.value===_.value.voiceChannel)))?void 0:e.label)+" ",1),s(c,{class:"iconfont icon-youjiantou"})]})),_:1})])),_:1}),s(r,{class:"w-p-100 flex flex-column gap-6 mt-20 bg-white p-15"},{default:t((()=>[s(c,{class:"fw-600"},{default:t((()=>[p("上传音频")])),_:1}),s(r,{class:"flex flex-center"},{default:t((()=>[s(x,{onSuccess:w})])),_:1})])),_:1}),s(b,{onSuccess:O},{default:t((()=>[p(m(u.value),1)])),_:1}),s(y,{ref_key:"popup",ref:h,mode:"bottom",round:"8px"},{default:t((()=>[(a(!0),P(E,null,S(v,((e,s)=>(a(),l(r,{class:"w-p-100 wa py-8 text-center border-bottom-f1",onClick:a=>{_.value.voiceChannel=e.value,h.value.close()}},{default:t((()=>[p(m(e.label),1)])),_:2},1032,["onClick"])))),256)),s(r,{class:"bg-white round-8 py-8 text-center text-red wa",onClick:n[1]||(n[1]=e=>h.value.close())},{default:t((()=>[p("取消")])),_:1})])),_:1},512)])),_:1})}}};export{z as default};

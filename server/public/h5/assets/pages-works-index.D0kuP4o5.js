import{u as e,_ as a}from"./useZPaging.D07IihSM.js";import{h as l,p as s,q as o,o as t,c as u,w as n,d as r,e as p,t as d,v as c,x as f,y as i,z as m,A as v,g as _,B as g,C as x,k as y,r as w,j as b,D as k,u as h,a as j,b as C,F as V,i as P,f as S,E as U,$ as z}from"./index-BqnPyf7q.js";import{_ as $,a as q}from"./empty.DN2eVeEL.js";import{_ as A}from"./z-paging.B2Kj_LD5.js";import{_ as E}from"./y-popup.D8SFmRKn.js";import{_ as F}from"./y-login.B6ujo5e1.js";import{g as L}from"./works.9lQ6wlfR.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./scene.Cc7KlbC1.js";import"./voice.DhVNepce.js";import"./user.gRU6mXR-.js";const M={__name:"y-download",setup(e,{expose:a}){const y=l(),w=l(0),b=l(),k=l(),h=()=>{c({title:"下载中..."}),"micromessenger"!==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?(b.value=m({url:k.value,success:e=>{v();let a=generateRandomString(20),l=k.value.split(".").pop();var s=document.createElement("a");s.download=`${a}.${l}`,s.href=e.tempFilePath,document.body.appendChild(s),s.click(),s.remove(),y.value.close()}}),y.value.open(),b.value.onProgressUpdate((e=>{w.value=e.progress}))):f({data:k.value,success(e){i({title:"复制成功",content:"链接已复制,请在外部浏览器打开下载"})}})};return a({downloadStart:e=>{k.value=e,h()}}),(e,a)=>{const l=_,c=g,f=x,m=s(o("y-popup"),E);return t(),u(m,{ref_key:"progressPopup",ref:y,round:"8"},{default:n((()=>[r(l,{class:"text-center fs-18 fw-bold pt-20"},{default:n((()=>[p(d(1==e.type?"视频":"音频")+"下载 ",1)])),_:1}),r(l,{class:"flex p-20 flex-y-center grid-gap-8 w-280"},{default:n((()=>[r(c,{percent:w.value,class:"w-p-100","show-info":"","border-radius":"10"},null,8,["percent"])])),_:1}),r(l,{class:"p-30"},{default:n((()=>[r(f,{onClick:a[0]||(a[0]=e=>{i({title:"取消下载",content:"是否确认取消？",success(e){e.confirm&&(b.value.abort(),y.value.close())}})}),class:"btn-blue text-white fs-14"},{default:n((()=>[p("取消下载")])),_:1})])),_:1})])),_:1},512)}}},B={__name:"index",setup(d){const{hasLogin:c,getUserInfo:f}=y(),i=l(0),m=l(null),v=l([]),g=l();l();const B=l(),D=l();e(m);const I=l(),Q=w([{label:"全部",value:0},{label:"完成",value:2},{label:"进行中",value:1},{label:"失败",value:3}]);b((()=>{c()?(m.value.reload(),f()):null==I||I.value.open()}));const R=(e,a)=>{L({page:e,limit:a,type:i.value}).then((e=>{m.value.complete(e.data)}))},Z=e=>{2==e.status&&(g.value=e.video_url,B.value.open())};return k((()=>{m.value&&c()&&m.value.reload()})),(e,l)=>{const d=s(o("y-tabs"),a),c=s(o("y-item-video"),$),f=_,y=P,w=S,b=s(o("z-paging"),A),k=U,L=x,G=s(o("y-popup"),E),H=s(o("y-download"),M),J=s(o("y-login"),F);return t(),u(f,{class:"px-12"},{default:n((()=>[r(d,{list:Q,modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=e=>i.value=e),onChange:l[1]||(l[1]=e=>m.value.reload())},null,8,["list","modelValue"]),r(b,{ref_key:"paging",ref:m,modelValue:v.value,"onUpdate:modelValue":l[4]||(l[4]=e=>v.value=e),onQuery:R,"use-page-scroll":"",auto:!1},{empty:n((()=>[r(f,{class:"w-p-100 flex flex-center flex-column"},{default:n((()=>[r(y,{src:q,class:"empty"}),r(f,{class:"w-p-100 flex flex-center"},{default:n((()=>[r(f,{class:"flex flex-column gap-8 flex-y-center w-p-100"},{default:n((()=>[r(w,{class:"fs-18 text-333 fw-bold"},{default:n((()=>[p("暂无作品")])),_:1}),r(w,{class:"fs-12 text-999"},{default:n((()=>[p("立即去创建一个吧")])),_:1}),r(f,{class:"btn-blue mt-10 w-p-70",onClick:l[3]||(l[3]=e=>h(z).open("/pages/created/works/index"))},{default:n((()=>[p("创建数字人 ")])),_:1})])),_:1})])),_:1})])),_:1})])),default:n((()=>[r(f,{class:"grid-columns-2 gap-10 mt-10"},{default:n((()=>[(t(!0),j(V,null,C(v.value,((e,a)=>(t(),u(c,{key:e.id,onSuccess:l[2]||(l[2]=e=>m.value.reload()),onClickCenter:Z,detail:e},null,8,["detail"])))),128))])),_:1})])),_:1},8,["modelValue"]),r(G,{ref_key:"popup",ref:B,mode:"bottom",round:"8px"},{default:n((()=>[r(f,{class:"p-20 flex flex-center flex-column gap-10"},{default:n((()=>[r(k,{src:g.value,class:"w-p-100 h-300"},null,8,["src"]),r(L,{class:"btn-blue w-p-100",onClick:l[5]||(l[5]=e=>{B.value.close(),D.value.downloadStart(g.value)})},{default:n((()=>[p("下载视频")])),_:1})])),_:1})])),_:1},512),r(H,{ref_key:"download",ref:D},null,512),r(G,{ref_key:"loginPopup",ref:I,mode:"bottom",round:"12px"},{default:n((()=>[r(f,{class:"pb-10"},{default:n((()=>[r(J,{onClose:l[6]||(l[6]=e=>I.value.close())})])),_:1})])),_:1},512)])),_:1})}}};export{B as default};

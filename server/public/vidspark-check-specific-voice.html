<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vidspark - æª¢æŸ¥ç‰¹å®šè²éŸ³å…‹éš†ç‹€æ…‹</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .info-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .info-box h3 {
            margin: 0 0 15px 0;
            color: #495057;
        }
        
        .form-group {
            margin: 20px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin: 10px 0;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .result-box.success {
            background: #d1edff;
            border-color: #0084ff;
            color: #0056b3;
        }
        
        .result-box.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .audio-player {
            margin: 15px 0;
        }
        
        .voice-card {
            background: #fff;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .voice-card h4 {
            color: #28a745;
            margin: 0 0 10px 0;
        }
        
        .voice-info {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .voice-info strong {
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æª¢æŸ¥ç‰¹å®šè²éŸ³å…‹éš†ç‹€æ…‹</h1>
        
        <div class="info-box">
            <h3>ğŸ“‹ ä»»å‹™ä¿¡æ¯</h3>
            <p><strong>Voice ID:</strong> 46ba7f03e4f54fc5a0f5dff93f2a02b1</p>
            <p><strong>Task ID:</strong> 198293</p>
            <p><strong>æäº¤æ™‚é–“:</strong> 2025-08-30 01:17:43</p>
            <p><strong>éŸ³é »æ–‡ä»¶:</strong> æ–°éŒ„éŸ³ 16.mp3 (756KB)</p>
        </div>
        
        <div class="form-group">
            <label for="api-token">GenHuman API Token:</label>
            <input type="password" id="api-token" placeholder="è«‹è¼¸å…¥æ‚¨çš„GenHuman API Token">
            <small style="color: #666;">Tokenæœƒè‡ªå‹•ä¿å­˜åˆ°localStorage</small>
        </div>
        
        <button class="btn" id="check-btn" onclick="checkSpecificVoice()">ğŸ” æª¢æŸ¥è²éŸ³å…‹éš†ç‹€æ…‹</button>
        <button class="btn" id="test-voice-btn" onclick="testClonedVoice()" disabled>ğŸµ æ¸¬è©¦å…‹éš†è²éŸ³</button>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div>æ­£åœ¨æŸ¥è©¢è²éŸ³ç‹€æ…‹...</div>
        </div>
        
        <div class="result-box" id="result" style="display: none;"></div>
        
        <div id="voice-details" style="display: none;"></div>
        
        <div id="voice-test-section" style="display: none;">
            <h3>ğŸµ æ¸¬è©¦å…‹éš†è²éŸ³</h3>
            <div class="form-group">
                <label for="test-text">æ¸¬è©¦æ–‡å­—:</label>
                <input type="text" id="test-text" value="ä½ å¥½ï¼Œé€™æ˜¯æˆ‘çš„å…‹éš†è²éŸ³æ¸¬è©¦ã€‚" placeholder="è¼¸å…¥è¦åˆæˆçš„æ–‡å­—">
            </div>
            <div id="voice-test-result"></div>
        </div>
    </div>

    <script>
        // ä¿å­˜çš„è²éŸ³ä¿¡æ¯
        let currentVoiceInfo = null;
        
        // é é¢åŠ è¼‰æ™‚æ¢å¾©Token
        document.addEventListener('DOMContentLoaded', function() {
            const savedToken = localStorage.getItem('vidspark_genhuman_token');
            if (savedToken) {
                document.getElementById('api-token').value = savedToken;
            }
        });
        
        // ä¿å­˜Token
        document.getElementById('api-token').addEventListener('change', function() {
            const token = this.value.trim();
            if (token) {
                localStorage.setItem('vidspark_genhuman_token', token);
            }
        });
        
        // æª¢æŸ¥ç‰¹å®šè²éŸ³å…‹éš†ç‹€æ…‹
        async function checkSpecificVoice() {
            const token = document.getElementById('api-token').value.trim();
            if (!token) {
                showResult('âŒ è«‹å…ˆè¼¸å…¥API Token', 'error');
                return;
            }
            
            const targetVoiceId = '46ba7f03e4f54fc5a0f5dff93f2a02b1';
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            document.getElementById('voice-details').style.display = 'none';
            document.getElementById('test-voice-btn').disabled = true;
            
            try {
                showResult('ğŸ” æ­£åœ¨æŸ¥è©¢æ‰€æœ‰è²éŸ³åˆ—è¡¨...', 'info');
                
                const response = await fetch('/vidspark-api-proxy/get-voice-roles', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        token: token.startsWith('Bearer ') ? token.substring(7) : token 
                    })
                });
                
                const result = await response.json();
                document.getElementById('loading').style.display = 'none';
                
                if (result.code === 200 && result.data) {
                    // æŸ¥æ‰¾ç‰¹å®šçš„è²éŸ³ID
                    const targetVoice = result.data.find(voice => voice.voice_id === targetVoiceId);
                    
                    if (targetVoice) {
                        // æ‰¾åˆ°äº†ï¼è²éŸ³å…‹éš†æˆåŠŸ
                        currentVoiceInfo = targetVoice;
                        showVoiceFound(targetVoice, result.data.length);
                        document.getElementById('test-voice-btn').disabled = false;
                        document.getElementById('voice-test-section').style.display = 'block';
                    } else {
                        // æ²’æ‰¾åˆ°ï¼Œå¯èƒ½é‚„åœ¨è™•ç†
                        showVoiceNotFound(result.data.length);
                    }
                    
                    // é¡¯ç¤ºæ‰€æœ‰è²éŸ³åˆ—è¡¨ä¾›åƒè€ƒ
                    showAllVoices(result.data);
                    
                } else {
                    showResult(`âŒ æŸ¥è©¢å¤±æ•—\néŒ¯èª¤ä»£ç¢¼: ${result.code}\néŒ¯èª¤ä¿¡æ¯: ${result.msg}`, 'error');
                }
                
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                showResult(`âŒ ç¶²çµ¡éŒ¯èª¤: ${error.message}`, 'error');
            }
        }
        
        // é¡¯ç¤ºæ‰¾åˆ°è²éŸ³çš„æƒ…æ³
        function showVoiceFound(voice, totalCount) {
            showResult(`ğŸ‰ è²éŸ³å…‹éš†æˆåŠŸå®Œæˆï¼
            
ğŸ“‹ è²éŸ³è©³æƒ…:
ğŸ¤ è²éŸ³ID: ${voice.voice_id}
ğŸ“ åç¨±: ${voice.name || 'æœªè¨­ç½®'}
ğŸ“„ æè¿°: ${voice.description || 'æœªè¨­ç½®'}
ğŸ• å‰µå»ºæ™‚é–“: ${voice.created_at || 'æœªçŸ¥'}
âœ¨ ç‹€æ…‹: å·²å¯ç”¨æ–¼èªéŸ³åˆæˆ

ğŸ“Š çµ±è¨ˆä¿¡æ¯:
ğŸ”¢ æ‚¨çš„è²éŸ³åº«ç¸½æ•¸: ${totalCount}å€‹è²éŸ³
â±ï¸ å¾æäº¤åˆ°å®Œæˆæ™‚é–“: å·²è¶…é5åˆ†é˜
âœ… è™•ç†ç‹€æ…‹: å®Œå…¨æˆåŠŸ`, 'success');
            
            // é¡¯ç¤ºè©³ç´°è²éŸ³å¡ç‰‡
            const voiceDetails = document.getElementById('voice-details');
            voiceDetails.innerHTML = `
                <div class="voice-card">
                    <h4>ğŸ¤ æ‚¨çš„å…‹éš†è²éŸ³å·²å°±ç·’</h4>
                    <div class="voice-info">
                        <strong>è²éŸ³ID:</strong> <span>${voice.voice_id}</span>
                        <strong>åç¨±:</strong> <span>${voice.name || 'æœªè¨­ç½®'}</span>
                        <strong>æè¿°:</strong> <span>${voice.description || 'æœªè¨­ç½®'}</span>
                        <strong>å‰µå»ºæ™‚é–“:</strong> <span>${voice.created_at || 'æœªçŸ¥'}</span>
                    </div>
                    <p style="color: #28a745; margin: 15px 0;">âœ… ç¾åœ¨å¯ä»¥ä½¿ç”¨é€™å€‹è²éŸ³ä¾†åˆæˆèªéŸ³äº†ï¼</p>
                </div>
            `;
            voiceDetails.style.display = 'block';
        }
        
        // é¡¯ç¤ºæ²’æ‰¾åˆ°è²éŸ³çš„æƒ…æ³
        function showVoiceNotFound(totalCount) {
            showResult(`â³ è²éŸ³ä»åœ¨è™•ç†ä¸­
            
ğŸ“‹ æŸ¥è©¢çµæœ:
âŒ ç›®æ¨™è²éŸ³IDæœªåœ¨è²éŸ³åˆ—è¡¨ä¸­æ‰¾åˆ°
ğŸ”¢ ç•¶å‰è²éŸ³åº«ç¸½æ•¸: ${totalCount}å€‹è²éŸ³
â° è™•ç†ç‹€æ…‹: ä»åœ¨ç”Ÿæˆä¸­

ğŸ’¡ å¯èƒ½åŸå› :
1. è²éŸ³å…‹éš†éœ€è¦æ›´é•·æ™‚é–“è™•ç†ï¼ˆå¤§æ–¼5åˆ†é˜ï¼‰
2. ç³»çµ±è™•ç†éšŠåˆ—è¼ƒå¿™
3. éŸ³é »æ–‡ä»¶è¼ƒå¤§éœ€è¦æ›´å¤šæ™‚é–“

ğŸ¯ å»ºè­°:
- ç­‰å¾…5-10åˆ†é˜å¾Œé‡æ–°æª¢æŸ¥
- å¤§éƒ¨åˆ†è²éŸ³å…‹éš†åœ¨15åˆ†é˜å…§å®Œæˆ`, 'error');
        }
        
        // é¡¯ç¤ºæ‰€æœ‰è²éŸ³åˆ—è¡¨
        function showAllVoices(voices) {
            let voiceList = '\n\nğŸ“‹ æ‚¨çš„å®Œæ•´è²éŸ³åº«:\n';
            voiceList += '=' .repeat(50) + '\n';
            
            if (voices.length === 0) {
                voiceList += 'ğŸ”‡ æš«ç„¡ä»»ä½•è²éŸ³\n';
            } else {
                voices.forEach((voice, index) => {
                    voiceList += `${index + 1}. ${voice.name || 'æœªå‘½å'}\n`;
                    voiceList += `   ğŸ“‹ ID: ${voice.voice_id}\n`;
                    voiceList += `   ğŸ“ æè¿°: ${voice.description || 'ç„¡'}\n`;
                    voiceList += `   ğŸ• æ™‚é–“: ${voice.created_at || 'æœªçŸ¥'}\n`;
                    voiceList += '   ' + '-'.repeat(40) + '\n';
                });
            }
            
            const currentResult = document.getElementById('result').textContent;
            showResult(currentResult + voiceList, document.getElementById('result').className.includes('success') ? 'success' : 'error');
        }
        
        // æ¸¬è©¦å…‹éš†è²éŸ³
        async function testClonedVoice() {
            if (!currentVoiceInfo) {
                showResult('âŒ è«‹å…ˆæª¢æŸ¥è²éŸ³ç‹€æ…‹', 'error');
                return;
            }
            
            const token = document.getElementById('api-token').value.trim();
            const testText = document.getElementById('test-text').value.trim();
            
            if (!testText) {
                document.getElementById('voice-test-result').innerHTML = 'âŒ è«‹è¼¸å…¥æ¸¬è©¦æ–‡å­—';
                return;
            }
            
            document.getElementById('voice-test-result').innerHTML = 'ğŸ”„ æ­£åœ¨åˆæˆèªéŸ³...';
            
            try {
                const response = await fetch('/vidspark-api-proxy/synthesize-voice', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        token: token.startsWith('Bearer ') ? token.substring(7) : token,
                        voice_id: currentVoiceInfo.voice_id,
                        text: testText
                    })
                });
                
                const result = await response.json();
                
                if (result.code === 200 && result.data && result.data.audio_url) {
                    document.getElementById('voice-test-result').innerHTML = `
                        <div class="voice-card">
                            <h4>ğŸµ èªéŸ³åˆæˆæˆåŠŸï¼</h4>
                            <p><strong>ä½¿ç”¨è²éŸ³:</strong> ${currentVoiceInfo.name} (${currentVoiceInfo.voice_id})</p>
                            <p><strong>åˆæˆæ–‡å­—:</strong> "${testText}"</p>
                            <div class="audio-player">
                                <audio controls style="width: 100%;">
                                    <source src="${result.data.audio_url}" type="audio/mpeg">
                                    æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æŒéŸ³é »æ’­æ”¾ã€‚
                                </audio>
                            </div>
                            <p><strong>éŸ³é »URL:</strong> <a href="${result.data.audio_url}" target="_blank">${result.data.audio_url}</a></p>
                        </div>
                    `;
                } else {
                    document.getElementById('voice-test-result').innerHTML = `âŒ èªéŸ³åˆæˆå¤±æ•—: ${result.msg}`;
                }
                
            } catch (error) {
                document.getElementById('voice-test-result').innerHTML = `âŒ æ¸¬è©¦éŒ¯èª¤: ${error.message}`;
            }
        }
        
        // é¡¯ç¤ºçµæœ
        function showResult(content, type = 'info') {
            const resultElement = document.getElementById('result');
            resultElement.className = `result-box ${type}`;
            resultElement.textContent = content;
            resultElement.style.display = 'block';
        }
    </script>
</body>
</html>
